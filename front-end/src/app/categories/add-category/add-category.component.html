<div class="container-fluid">
 <div class="row py-3 bg-light">
  <div class="col-3 d-flex align-items-center">
   <app-time></app-time>
  </div>
  <div class="col-6 text-center">
   <h4 class="header m-auto">اضافة صنف</h4>
  </div>
  <div class="col-3 d-flex align-items-center justify-content-end">
   <!-- مساحة فارغة أو أيقونات مستقبلية -->
  </div>
 </div>
</div>

<div class="container content mt-4">
 <div *ngIf="errorMessage" class="mb-3">
  <h3 class="alert alert-danger text-center">{{ errorMessage }}</h3>
 </div>

 <form #addCat="ngForm" (ngSubmit)="addCategory(addCat)" enctype="multipart/form-data">

  <!-- اسم الصنف وكود الصنف -->
  <div class="form-row">
   <div class="form-group col-md-6">
    <label for="category_name">اسم الصنف</label>
    <ng-autocomplete name="category_name" [(ngModel)]="category_name" [data]="products" [searchKeyword]="catword"
     required (selected)="productChange($event)" (inputCleared)="resetInp()" [itemTemplate]="itemTemplates"
     [notFoundTemplate]="notFoundTemplate">
    </ng-autocomplete>

    <ng-template #itemTemplates let-item>
     <a [innerHTML]="item.category_name"></a>
    </ng-template>

    <ng-template #notFoundTemplate let-notFound>
     <div [innerHTML]="notFound"></div>
    </ng-template>
   </div>

   <div class="form-group col-md-6">
    <label for="category_code">كود الصنف</label>
    <input type="text" name="category_code" ngModel #category_code="ngModel" class="form-control" id="category_code"
     aria-describedby="category_code" required />
    <div class="form-text text-danger" *ngIf="category_code.touched && category_code.invalid">
     <div *ngIf="category_code.errors?.['required']">يجب ادخال كود الصنف</div>
    </div>
   </div>
  </div>

  <!-- سعر الصنف ورصيد افتتاحي -->
  <div class="form-row mt-3">
   <div class="form-group col-md-6">
    <label for="price">سعر الصنف</label>
    <input type="number" name="price" ngModel #price="ngModel" class="form-control" id="price" aria-describedby="price"
     required min="0" />
    <div class="form-text text-danger" *ngIf="price.touched && price.invalid">
     <div *ngIf="price.errors?.['required']">يجب ادخال سعر الصنف</div>
     <div *ngIf="price.errors?.['min']">يجب ادخال سعر صحيح</div>
    </div>
   </div>

   <div class="form-group col-md-6">
    <label for="inital_price">الرصيد الافتتاحي</label>
    <input type="number" name="inital_price" ngModel #inital_price="ngModel" class="form-control" id="inital_price"
     aria-describedby="inital_price" required min="0" />
    <div class="form-text text-danger" *ngIf="inital_price.touched && inital_price.invalid">
     <div *ngIf="inital_price.errors?.['required']">يجب ادخال رصيد افتتاحي</div>
     <div *ngIf="inital_price.errors?.['min']">يجب ادخال رصيد افتتاحي صحيح</div>
    </div>
   </div>
  </div>

  <!-- الحد الأدنى للمخزون -->
  <div class="form-row mt-3">
   <div class="form-group col-md-6">
    <label for="min_quantity">الحد الادنى للمخزون</label>
    <input type="number" name="min_quantity" ngModel #min_quantity="ngModel" class="form-control" id="min_quantity"
     aria-describedby="min_quantity" required min="0" />
    <div class="form-text text-danger" *ngIf="min_quantity.touched && min_quantity.invalid">
     <div *ngIf="min_quantity.errors?.['required']">يجب ادخال الحد الادنى للمخزن</div>
     <div *ngIf="min_quantity.errors?.['min']">يجب ادخال رقم صحيح</div>
    </div>
   </div>
  </div>

  <!-- المخزن، وحدة القياس، خط الانتاج -->
  <div class="form-row mt-3">
   <div class="form-group col-md-4">
    <label for="warehouse">المخزن</label>
    <select class="form-control" name="warehouse" ngModel required #warehouse="ngModel"
     (change)="onWarehouseChange($event)">
     <option selected disabled value="">اختر المخزن</option>
     <ng-container *ngFor="let elm of stockData">
      <option *ngIf="(
                      ((user == 'Admin' || user == 'Account Management' || user == 'Logistics Specialist') 
                        && (elm.name == 'مخزن مواد خام' || elm.name == 'مخزن منتج تحت التشغيل')) 
                      || 
                      ((user == 'Admin' || user == 'Data Entry') 
                        && elm.name == 'مخزن منتج تام')
                    )" [value]="elm.name">
       {{ elm.name }}
      </option>
     </ng-container>
    </select>
    <div class="form-text text-danger" *ngIf="warehouse.invalid && (warehouse.dirty || warehouse.touched)">
     <div *ngIf="warehouse.errors?.['required']">من فضلك اختر نوع المخزن</div>
    </div>
   </div>

   <div class="form-group col-md-4">
    <label for="unit">وحدة القياس</label>
    <select class="form-control" name="unit" ngModel required #unit="ngModel">
     <option selected disabled value="">اختر وحدة القياس</option>
     <option *ngFor="let unit of unitsData" [value]="unit.id">{{ unit.unit }}</option>
    </select>
    <div class="form-text text-danger" *ngIf="unit.invalid && (unit.dirty || unit.touched)">
     <div *ngIf="unit.errors?.['required']">من فضلك اختر وحدة القياس</div>
    </div>
   </div>

   <div class="form-group col-md-4">
    <label for="production">خط الانتاج</label>
    <select class="form-control" name="production" ngModel required #production="ngModel">
     <option selected disabled value="">اختر خط الانتاج</option>
     <option *ngFor="let production of productionData" [value]="production.id">{{ production.production_line }}</option>
    </select>
    <div class="form-text text-danger" *ngIf="production.invalid && (production.dirty || production.touched)">
     <div *ngIf="production.errors?.['required']">من فضلك اختر خط الانتاج</div>
    </div>
   </div>
  </div>

  <!-- صورة الصنف -->
  <div class="form-group mt-3">
   <label>صورة الصنف</label>
   <div class="element d-flex align-items-center">
    <i (click)="openFileInput()" class="fa fa-camera mr-2" style="cursor:pointer;"></i>
    <span class="name">{{ imgtext }}</span>
    <input type="file" (change)="onFileChanged($event)" name="uploadFile" accept="image/*" id="fileInput"
     #uploadFile="ngModel" ngModel class="img d-none">
   </div>
   <div class="form-text text-danger" *ngIf="uploadFile.invalid && fileopend">
    <div *ngIf="uploadFile.errors?.['required']">من فضلك اختر صورة</div>
   </div>
  </div>

  <button type="submit" [disabled]="addCat.invalid" class="btn btn-primary mt-3">اضف</button>
 </form>
</div>