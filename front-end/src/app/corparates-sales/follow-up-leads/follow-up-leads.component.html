<div class="container-fluid">
  <div class="row py-3">
    <div class="col-4 d-flex align-items-center">
      <app-time></app-time>
    </div>
    <div class="col-5">
      <div>
        <p class="title header w-50 m-auto">Follow-Up Leads</p>
      </div>
    </div>
    <div class="col-3 d-flex align-items-center justify-content-end">
      <button class="btn btn-primary" (click)="loadFollowUpLeads()">
        <i class="fa-solid fa-refresh me-2"></i>Refresh
      </button>
    </div>
  </div>

  <div class="container-fluid mt-4" *ngIf="!isLoading; else loading">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">Leads Requiring Follow-Up</h5>
            <small class="text-muted">Manage your follow-up schedule and overdue actions</small>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Company</th>
                    <th>Contact</th>
                    <th>Status</th>
                    <th>Next Action</th>
                    <th>Action Date</th>
                    <th>Priority</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let lead of followUpLeads">
                    <td>
                      <strong>{{ lead.company_name }}</strong>
                      <div *ngIf="lead.contact_title" class="small text-muted">
                        {{ lead.contact_title }}
                        <span *ngIf="lead.contact_department">â€¢ {{ lead.contact_department }}</span>
                      </div>
                    </td>
                    <td>
                      <div *ngIf="lead.contacts && lead.contacts.length > 0">
                        <div>{{ lead.contacts[0].contact_name }}</div>
                        <div class="small text-muted" *ngIf="lead.contacts[0].phones && lead.contacts[0].phones.length > 0">
                          {{ lead.contacts[0].phones[0].dial_code }} {{ lead.contacts[0].phones[0].contact_number }}
                        </div>
                      </div>
                      <span *ngIf="!lead.contacts || lead.contacts.length === 0" class="text-muted">No contacts</span>
                    </td>
                    <td>
                      <span class="badge" [style.background-color]="lead.status?.color || '#6c757d'" style="color: white;">
                        {{ lead.status?.name }}
                      </span>
                    </td>
                    <td>
                      <div>
                        <strong>{{ lead.next_action_type || 'Not specified' }}</strong>
                        <div *ngIf="lead.next_action_notes" class="small text-muted">
                          {{ lead.next_action_notes }}
                        </div>
                      </div>
                    </td>
                    <td>
                      <div>
                        {{ lead.next_action_date | date:'mediumDate' }}
                        <div>
                          <span [class]="getFollowUpStatusClass(lead)">
                            {{ getFollowUpStatusText(lead) }}
                          </span>
                        </div>
                      </div>
                    </td>
                    <td>
                      <span [class]="getFollowUpStatusClass(lead)">
                        {{ getFollowUpStatusText(lead) }}
                      </span>
                    </td>
                    <td>
                      <div class="btn-group btn-group-sm" role="group">
                        <button type="button" class="btn btn-outline-success" 
                                (click)="completeFollowUp(lead)"
                                title="Mark as Completed">
                          <i class="fa-solid fa-check"></i>
                        </button>
                        <button type="button" class="btn btn-outline-primary" 
                                title="View Details">
                          <i class="fa-solid fa-eye"></i>
                        </button>
                        <button type="button" class="btn btn-outline-warning" 
                                title="Reschedule">
                          <i class="fa-solid fa-calendar"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
              
              <div *ngIf="followUpLeads.length === 0" class="text-center py-4">
                <i class="fa-solid fa-check-circle fa-3x text-success mb-3"></i>
                <h5>No Follow-Up Required</h5>
                <p class="text-muted">Great! All leads are up to date.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Template -->
  <ng-template #loading>
    <div class="text-center mt-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Loading follow-up leads...</p>
    </div>
  </ng-template>
</div>
