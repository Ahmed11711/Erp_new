<div class="container-fluid">
  <div class="row py-3">
    <div class="col-4 d-flex align-items-center">
      <app-time></app-time>
    </div>
    <div class="col-5">
      <div><p class="title header w-50 m-auto">Lead Details</p></div>
    </div>
    <div class="col-3 d-flex align-items-center justify-content-end">
      <!-- <app-time></app-time> -->
    </div>
  </div>



<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-header d-flex justify-content-end" >
          <h5 class="mb-0" style="font-size: 20px; font-weight: 500;">Company Details</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table dir="ltr" class="table table-bordered table-hover text-center mb-0">
              <thead   class="text-white">
                <tr>
                  <th>Company Name</th>
                  <th>Country</th>
                  <th>Industry</th>
                  <th>Source</th>
                  <th>Tool</th>
                  <th>LinkedIn</th>
                  <th>Website</th>
                  <th>Facebook</th>
                  <th>Instagram</th>
                  <th>Created By</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>{{ data?.company_name }} <i class="mx-2 fa-solid fa-pen" (click)="editCompanyName(data?.company_name)"></i></td>
                  <td>{{ data?.country_name }}</td>
                  <td>{{ data?.industry?.name || '-' }}</td>
                  <td>{{ data?.source?.name || '-' }}</td>
                  <td>{{ data?.tool?.name || '-' }}</td>
                  <td>
                    <a *ngIf="data?.company_linkedin" [href]="data.company_linkedin" target="_blank" class="btn btn-sm btn-outline-primary">
                      LinkedIn
                    </a>
                    <i class="mx-2 fa-solid fa-pen" (click)="editCompanyLinkedIn(data?.company_linkedin)"></i>
                  </td>
                  <td>
                    <a *ngIf="data?.company_website" [href]="data.company_website" target="_blank" class="btn btn-sm btn-outline-secondary">
                      Website
                    </a>
                    <i class="mx-2 fa-solid fa-pen" (click)="editCompanyWebsite(data?.company_website)"></i>
                  </td>
                  <td>
                    <a *ngIf="data?.company_facebook" [href]="data.company_facebook" target="_blank" class="btn btn-sm btn-outline-primary">
                      Facebook
                    </a>
                    <i class="mx-2 fa-solid fa-pen" (click)="editCompanyFacebook(data?.company_facebook)"></i>
                  </td>
                  <td>
                    <a *ngIf="data?.company_instagram" [href]="data.company_instagram" target="_blank" class="btn btn-sm btn-outline-danger">
                      Instagram
                    </a>
                    <i class="mx-2 fa-solid fa-pen" (click)="editCompanyInstagram(data?.company_instagram)"></i>
                  </td>
                  <td>{{ data?.user?.name || '-' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-12">
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-header d-flex justify-content-end" >
          <h5 class="mb-0" style="font-size: 20px; font-weight: 500;">Contact Details</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table dir="ltr" class="table table-bordered table-hover text-center mb-0">
              <thead   class="text-white">
                <tr>
                  <th>#</th>
                  <th>Name</th>
                  <th>LinkedIn</th>
                  <th>Emails</th>
                  <th>Phones</th>
                  <th>Created By</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let contact of data?.contact; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td class="fw-semibold">{{ contact.name }}<i class="mx-2 fa-solid fa-pen" (click)="editContactName(contact.id,contact.name)"></i></td>
                  <td>
                    <a [href]="contact.contact_linkedin" target="_blank" class="btn btn-sm btn-outline-primary">
                      LinkedIn
                    </a>
                    <i class="mx-2 fa-solid fa-pen" (click)="editContactLinkedIn(contact.id,contact.contact_linkedin)"></i>
                  </td>
                  <td>
                    <ul class="list-unstyled mb-0 text-start">
                      <li *ngFor="let email of contact.emails">
                        {{ email.email }}
                        <span class="text-muted small">| {{ email.user?.name }}</span>
                        <i class="mx-2 fa-solid fa-pen" (click)="editEmail(email)"></i>
                      </li>
                    </ul>
                    <button class="btn bg-main my-2" style="width: fit-content;" (click)="addEmailToContact(contact.id)">Add Email</button>
                  </td>
                  <td>
                    <ul class="list-unstyled mb-0 text-start">
                      <li *ngFor="let phone of contact.phones">
                        {{ phone.dial_code }} {{ phone.contact_number }}
                        <span class="text-muted small">| {{ phone.user?.name }}</span>
                        <i class="mx-2 fa-solid fa-pen" (click)="editPhone(phone.id, phone.dial_code,phone.contact_number)"></i>
                      </li>
                    </ul>
                    <button class="btn bg-main my-2" style="width: fit-content;" (click)="addPhoneToContact(contact.id)">Add Phone</button>
                  </td>
                  <td>{{ contact.user?.name }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="d-flex flex-column align-items-end" style="margin-inline-end: 10px;">
            <button class="btn bg-main my-2" style="width: fit-content;" (click)="addContact()">Add Contact</button>
          </div>
        </div>
      </div>
    </div>


    <div class="col-md-6">
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-header d-flex justify-content-end">
          <h5 class="mb-0" style="font-size: 20px; font-weight: 500;">Tracking</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive" style="max-height: 1000px;">
            <table dir="ltr" class="table table-bordered table-hover text-center mb-0" >
              <thead   class="text-white">
                <tr>
                  <th>#</th>
                  <th>Details</th>
                  <th>Value</th>
                  <th>By</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let track of data?.tracking; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td>{{ track.details }}</td>
                  <td>
                    <ng-container *ngIf="track.details === 'add Progress' && isImage(track.new_value); else plain">
                      <img
                        [src]="imgUrl + track.new_value"
                        alt="Preview"
                        width="30px"
                        style="max-width:100%;height:auto;cursor:pointer"
                        (click)="showImg($event)"
                      />
                    </ng-container>
                    <ng-template #plain>
                      <span title="Old: {{ track.old_value || '' }}">
                        {{ track.new_value }}
                      </span>

                    </ng-template>
                  </td>

                  <td>{{ track.user?.name }}</td>
                  <td>{{ track.created_at | date: 'short' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-header d-flex justify-content-end" >
          <h5 class="mb-0" style="font-size: 20px; font-weight: 500;">Notes</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive" style="max-height: 400px;">
            <table dir="ltr" class="table table-bordered table-hover mb-0 text-center">
              <thead   class="text-white">
                <tr>
                  <th>#</th>
                  <th>Note</th>
                  <th>By</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let note of data?.notes; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td class="text-start">{{ note.note }}</td>
                  <td>{{ note.user?.name }}</td>
                  <td>{{ note.created_at | date: 'short' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="d-flex flex-column align-items-end" style="margin-inline-end: 10px;">
            <button class="btn bg-main my-2" style="width: fit-content;" (click)="addToLead('note', 'add Note')">Add Note</button>
        </div>
        </div>
      </div>
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-header d-flex justify-content-end" >
          <h5 class="mb-0" style="font-size: 20px; font-weight: 500;">Progress</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive" style="max-height: 400px;">
            <table dir="ltr" class="table table-bordered table-hover mb-0 text-center">
              <thead   class="text-white">
                <tr>
                  <th>#</th>
                  <th>Progress</th>
                  <th>File</th>
                  <th>By</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of data?.progress; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td class="text-start">{{ item.progress }}</td>
                  <td>
                    <img *ngIf="item.file" (click)="showImg($event)" class="img-fluid cursor-pointer" style="width: 30px; cursor: pointer;" [src]="imgUrl+item?.file">
                    <!-- <span *ngIf="!item.file" class="text-muted">No File</span> -->
                  </td>
                  <td>{{ item.user?.name }}</td>
                  <td>{{ item.created_at | date: 'short' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="d-flex flex-column align-items-end" style="margin-inline-end: 10px;">
          <button class="btn bg-main my-2" style="width: fit-content;" (click)="addToLead('progress', 'add Progress')">Add Progress</button>
          <button class="btn bg-main mb-2" style="width: fit-content;" (click)="openFileInput()">Upload Photo</button>
          <input type="file" (change)="onFileChanged($event)" name="uploadFile"  accept="image/*" id="fileInput" #uploadFile="ngModel" ngModel class="img d-none">
        </div>
      </div>
    </div>

  </div>
</div>
