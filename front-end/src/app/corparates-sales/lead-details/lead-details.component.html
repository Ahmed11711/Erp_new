<div class="container-fluid">
  <div class="row py-3">
    <div class="col-4 d-flex align-items-center">
      <app-time></app-time>
    </div>
    <div class="col-5">
      <div><p class="title header w-50 m-auto">Lead Details</p></div>
    </div>
    <div class="col-3 d-flex align-items-center justify-content-end">
      <!-- <app-time></app-time> -->
    </div>
  </div>



<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-header d-flex justify-content-end" >
          <h5 class="mb-0" style="font-size: 20px; font-weight: 500;">تفاصيل الشركة</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table dir="ltr" class="table table-bordered table-hover text-center mb-0">
              <thead   class="text-white">
                <tr>
                  <th>اسم الشركة</th>
                  <th>حالة العميل</th>
                  <th>المنصب</th>
                  <th>القسم</th>
                  <th>الدولة</th>
                  <th>الصناعة</th>
                  <th>المصدر</th>
                  <th>الأداة</th>
                  <th>LinkedIn</th>
                  <th>الموقع الإلكتروني</th>
                  <th>Facebook</th>
                  <th>Instagram</th>
                  <th>أضافه بواسطة</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>{{ data?.company_name }} <i class="mx-2 fa-solid fa-pen" (click)="editCompanyName(data?.company_name)"></i></td>
                  <td>
                    <span class="status-badge" [ngClass]="getStatusClass(getStatusDisplay(data))">
                      {{ getStatusDisplay(data) }}
                    </span>
                    <i class="mx-2 fa-solid fa-pen" (click)="editLeadStatus(data?.lead_status?.id || data?.status?.id || data?.lead_status_id, data?.lead_status?.name || data?.status?.name || data?.lead_status?.status_name || data?.status?.status_name)"></i>
                  </td>
                  <td>{{ data?.contact_title || '-' }} <i class="mx-2 fa-solid fa-pen" (click)="editContactTitle(data?.contact_title)"></i></td>
                  <td>{{ data?.contact_department || '-' }} <i class="mx-2 fa-solid fa-pen" (click)="editContactDepartment(data?.contact_department)"></i></td>
                  <td>{{ data?.country_name }}</td>
                  <td>{{ data?.industry?.name || '-' }}</td>
                  <td>{{ data?.source?.name || '-' }}</td>
                  <td>{{ data?.tool?.name || '-' }}</td>
                  <td>
                    <a *ngIf="data?.company_linkedin" [href]="data.company_linkedin" target="_blank" class="btn btn-sm btn-outline-primary">
                      LinkedIn
                    </a>
                    <i class="mx-2 fa-solid fa-pen" (click)="editCompanyLinkedIn(data?.company_linkedin)"></i>
                  </td>
                  <td>
                    <a *ngIf="data?.company_website" [href]="data.company_website" target="_blank" class="btn btn-sm btn-outline-secondary">
                      Website
                    </a>
                    <i class="mx-2 fa-solid fa-pen" (click)="editCompanyWebsite(data?.company_website)"></i>
                  </td>
                  <td>
                    <a *ngIf="data?.company_facebook" [href]="data.company_facebook" target="_blank" class="btn btn-sm btn-outline-primary">
                      Facebook
                    </a>
                    <i class="mx-2 fa-solid fa-pen" (click)="editCompanyFacebook(data?.company_facebook)"></i>
                  </td>
                  <td>
                    <a *ngIf="data?.company_instagram" [href]="data.company_instagram" target="_blank" class="btn btn-sm btn-outline-danger">
                      Instagram
                    </a>
                    <i class="mx-2 fa-solid fa-pen" (click)="editCompanyInstagram(data?.company_instagram)"></i>
                  </td>
                  <td>{{ data?.user?.name || '-' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Details Section -->
    <!-- <div class="col-md-12">
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-header d-flex justify-content-end" >
          <h5 class="mb-0" style="font-size: 20px; font-weight: 500;">تفاصيل إضافية</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table dir="ltr" class="table table-bordered table-hover text-center mb-0">
              <thead class="text-white">
                <tr>
                  <th>حجم الشركة</th>
                  <th>الإيرادات السنوية</th>
                  <th>القطاع الصناعي</th>
                  <th>المنطقة الجغرافية</th>
                  <th>المنافسون الرئيسيون</th>
                  <th>أولوية العميل</th>
                  <th>المنتجات/الخدمات المطلوبة</th>
                  <th>الميزانية المتوقعة</th>
                  <th>الإطار الزمني للمشروع</th>
                  <th>صانع القرار</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    {{ getCompanySizeDisplay(data?.company_size) || '-' }}
                    <i class="mx-2 fa-solid fa-pen" (click)="editCompanySize(data?.company_size)"></i>
                  </td>
                  <td>
                    {{ getRevenueDisplay(data?.annual_revenue) || '-' }}
                    <i class="mx-2 fa-solid fa-pen" (click)="editAnnualRevenue(data?.annual_revenue)"></i>
                  </td>
                  <td>
                    {{ getIndustrySectorDisplay(data?.industry_sector) || '-' }}
                    <i class="mx-2 fa-solid fa-pen" (click)="editIndustrySector(data?.industry_sector)"></i>
                  </td>
                  <td>
                    {{ data?.geographic_region || '-' }}
                    <i class="mx-2 fa-solid fa-pen" (click)="editGeographicRegion(data?.geographic_region)"></i>
                  </td>
                  <td>
                    {{ data?.main_competitors || '-' }}
                    <i class="mx-2 fa-solid fa-pen" (click)="editMainCompetitors(data?.main_competitors)"></i>
                  </td>
                  <td>
                    <span class="badge" [ngClass]="getPriorityClass(data?.lead_priority)">
                      {{ getPriorityDisplay(data?.lead_priority) || '-' }}
                    </span>
                    <i class="mx-2 fa-solid fa-pen" (click)="editLeadPriority(data?.lead_priority)"></i>
                  </td>
                  <td>
                    {{ data?.required_products || '-' }}
                    <i class="mx-2 fa-solid fa-pen" (click)="editRequiredProducts(data?.required_products)"></i>
                  </td>
                  <td>
                    {{ data?.expected_budget || '-' }}
                    <i class="mx-2 fa-solid fa-pen" (click)="editExpectedBudget(data?.expected_budget)"></i>
                  </td>
                  <td>
                    {{ getTimelineDisplay(data?.project_timeline) || '-' }}
                    <i class="mx-2 fa-solid fa-pen" (click)="editProjectTimeline(data?.project_timeline)"></i>
                  </td>
                  <td>
                    {{ getDecisionMakerDisplay(data?.decision_maker) || '-' }}
                    <i class="mx-2 fa-solid fa-pen" (click)="editDecisionMaker(data?.decision_maker)"></i>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div> -->

    <div class="col-md-12">
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-header d-flex justify-content-end" >
          <h5 class="mb-0" style="font-size: 20px; font-weight: 500;">تفاصيل جهة الاتصال</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table dir="ltr" class="table table-bordered table-hover text-center mb-0">
              <thead   class="text-white">
                <tr>
                  <th>#</th>
                  <th>الاسم</th>
                  <th>LinkedIn</th>
                  <th>البريد الإلكتروني</th>
                  <th>أرقام الهاتف</th>
                  <th>أضافه بواسطة</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let contact of data?.contact; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td class="fw-semibold">{{ contact.name }}<i class="mx-2 fa-solid fa-pen" (click)="editContactName(contact.id,contact.name)"></i></td>
                  <td>
                    <a [href]="contact.contact_linkedin" target="_blank" class="btn btn-sm btn-outline-primary">
                      LinkedIn
                    </a>
                    <i class="mx-2 fa-solid fa-pen" (click)="editContactLinkedIn(contact.id,contact.contact_linkedin)"></i>
                  </td>
                  <td>
                    <ul class="list-unstyled mb-0 text-start">
                      <li *ngFor="let email of contact.emails">
                        {{ email.email }}
                        <span class="text-muted small">| {{ email.user?.name }}</span>
                        <i class="mx-2 fa-solid fa-pen" (click)="editEmail(email)"></i>
                      </li>
                    </ul>
                    <button class="btn bg-main my-2" style="width: fit-content;" (click)="addEmailToContact(contact.id)">إضافة بريد إلكتروني</button>
                  </td>
                  <td>
                    <ul class="list-unstyled mb-0 text-start">
                      <li *ngFor="let phone of contact.phones">
                        {{ phone.dial_code }} {{ phone.contact_number }}
                        <span class="text-muted small">| {{ phone.user?.name }}</span>
                        <i class="mx-2 fa-solid fa-pen" (click)="editPhone(phone.id, phone.dial_code,phone.contact_number)"></i>
                      </li>
                    </ul>
                    <button class="btn bg-main my-2" style="width: fit-content;" (click)="addPhoneToContact(contact.id)">إضافة هاتف</button>
                  </td>
                  <td>{{ contact.user?.name }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="d-flex flex-column align-items-end" style="margin-inline-end: 10px;">
            <button class="btn bg-main my-2" style="width: fit-content;" (click)="addContact()">إضافة جهة اتصال</button>
          </div>
        </div>
      </div>
    </div>


    <div class="col-md-6">
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-header d-flex justify-content-end">
          <h5 class="mb-0" style="font-size: 20px; font-weight: 500;">التتبع</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive" style="max-height: 1000px;">
            <table dir="ltr" class="table table-bordered table-hover text-center mb-0" >
              <thead   class="text-white">
                <tr>
                  <th>#</th>
                  <th>التفاصيل</th>
                  <th>القيمة</th>
                  <th>بواسطة</th>
                  <th>التاريخ</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let track of data?.tracking; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td>{{ track.details }}</td>
                  <td>
                    <ng-container *ngIf="track.details === 'add Progress' && isImage(track.new_value); else plain">
                      <img
                        [src]="imgUrl + track.new_value"
                        alt="Preview"
                        width="30px"
                        style="max-width:100%;height:auto;cursor:pointer"
                        (click)="showImg($event)"
                      />
                    </ng-container>
                    <ng-template #plain>
                      <span title="Old: {{ track.old_value || '' }}">
                        {{ track.new_value }}
                      </span>

                    </ng-template>
                  </td>

                  <td>{{ track.user?.name }}</td>
                  <td>{{ track.created_at | date: 'short' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-header d-flex justify-content-end" >
          <h5 class="mb-0" style="font-size: 20px; font-weight: 500;">الملاحظات</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive" style="max-height: 400px;">
            <table dir="ltr" class="table table-bordered table-hover mb-0 text-center">
              <thead   class="text-white">
                <tr>
                  <th>#</th>
                  <th>الملاحظة</th>
                  <th>بواسطة</th>
                  <th>التاريخ</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let note of data?.notes; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td class="text-start">{{ note.note }}</td>
                  <td>{{ note.user?.name }}</td>
                  <td>{{ note.created_at | date: 'short' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="d-flex flex-column align-items-end" style="margin-inline-end: 10px;">
            <button class="btn bg-main my-2" style="width: fit-content;" (click)="addToLead('note', 'add Note')">إضافة ملاحظة</button>
        </div>
        </div>
      </div>
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-header d-flex justify-content-end" >
          <h5 class="mb-0" style="font-size: 20px; font-weight: 500;">التقدم</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive" style="max-height: 400px;">
            <table dir="ltr" class="table table-bordered table-hover mb-0 text-center">
              <thead   class="text-white">
                <tr>
                  <th>#</th>
                  <th>التقدم</th>
                  <th>الملف</th>
                  <th>بواسطة</th>
                  <th>التاريخ</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of data?.progress; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td class="text-start">{{ item.progress }}</td>
                  <td>
                    <img *ngIf="item.file" (click)="showImg($event)" class="img-fluid cursor-pointer" style="width: 30px; cursor: pointer;" [src]="imgUrl+item?.file">
                    <!-- <span *ngIf="!item.file" class="text-muted">No File</span> -->
                  </td>
                  <td>{{ item.user?.name }}</td>
                  <td>{{ item.created_at | date: 'short' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="d-flex flex-column align-items-end" style="margin-inline-end: 10px;">
            <button class="btn bg-main my-2" style="width: fit-content;" (click)="addToLead('progress', 'add Progress')">إضافة تقدم</button>
          <button class="btn bg-main mb-2" style="width: fit-content;" (click)="openFileInput()">رفع صورة</button>
          <input type="file" (change)="onFileChanged($event)" name="uploadFile"  accept="image/*" id="fileInput" #uploadFile="ngModel" ngModel class="img d-none">
        </div>
      </div>
    </div>

  </div>
</div>
